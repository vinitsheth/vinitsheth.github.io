<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->

<head>
    <style type="text/css">
	    .article-wrap img{border-radius: 5px;}
		.titled-image figure{text-align: center;}
	</style>
	<meta charset="utf-8">
<title>Vinit Sheth's Website  &#8211; Image Resizer Python Web App </title>
<meta name="description" content="">
<meta name="keywords" content="Web App">




<!-- MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Image Resizer Python Web App">
<meta property="og:description" content="Welcome to my site.">
<meta property="og:url" content="http://localhost:4000/Extras/2017-08-26-Image-Resizer-Web-App/">
<meta property="og:site_name" content="Vinit Sheth's Website">





<link rel="canonical" href="http://localhost:4000/Extras/2017-08-26-Image-Resizer-Web-App/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Vinit Sheth's Website Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.min.css">
<link rel="stylesheet" href="http://localhost:4000/assets/academicons.css" />

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">

<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="192x192" href="http://localhost:4000/images/apple-icon-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://localhost:4000">Vinit Sheth's Website</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				<li><a href="http://localhost:4000/cv/" >Curriculum</a></li>
		        
				<li><a href="http://localhost:4000/projects/" >Projects</a></li>
		        
				<li><a href="http://localhost:4000/courses/" >Courses</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    
	<img src="http://localhost:4000/images//author_images/VinitSmall.jpg" class="bio-photo" alt="Vinit Sheth bio photo"></a>

<h3>Vinit Sheth</h3>
<p>Data Science , Machine Learning, Artificial Intelligence.</p>



<a href="http://linkedin.com/in/vinit-sheth" class="author-social" target="_blank"><i class="fa fa-linkedin-square"></i> LinkedIn</a>


<a href="http://github.com/vinitsheth" class="author-social" target="_blank"><i class="fa fa-github-square"></i> GitHub</a>









<a href="http://facebook.com/vinitgsheth" class="author-social" target="_blank"><i class="fa fa-facebook-square"></i> Facebook</a>
<a href="mailto:vsheth2@asu.edu" class="author-social" target="_blank"><i class="fa fa-envelope-square"></i> E-Mail</a>
<a href="https://drive.google.com/open?id=1ElcWvlcYgbx_Pw4amAY230AAM5meI6zQ" class="author-social" target="_blank"><i class="fa fa-file"></i>Resume</a>
  </div>
  <article>
    <div class="headline-wrap">
      
        <h1><a href="http://localhost:4000/Extras/2017-08-26-Image-Resizer-Web-App/" rel="bookmark" title="Image Resizer Python Web App">Image Resizer Python Web App</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <h3 id="introduction">Introduction</h3>

<p>Since I am hosting my own websites, I sometimes have to prepare some png-formatted images with the right size for my website. So I developed this <a href="http://imageresizer.pythonanywhere.com/">Image Resizer</a> web application using Python in two days, and hosted it on PythonAnywhere. This is formally my first experience of developing web applications, and I think I have learned a lot.</p>

<h3 id="mannual">Mannual</h3>

<p>This is the Image Resizer Web Application Interface. It is extremely simple and advertisement free. You will just have to select your image file, select the resizing mode (use width and height / use ratio), and input your parameter. The Image Resizer could enlarge or shrink the images. But the performance of shrinking images is the best. After submitting the image and parameters, you will be allowed to download the image resized in png format.</p>

<figure>
    <img src="http://localhost:4000/images/projects/2017-08-26-Image-Resizer-Web-App/image_resizer_index.png" />
    <figcaption>Image Resizer Web Application Interface</figcaption>
</figure>

<h3 id="development-experience">Development Experience</h3>

<p>I have never developed my own web applicaton before, and I have only tried a simple web application tutorial provided by Python Anywhere (see my <a href="https://leimao.github.io/article/PythonAnywhere-WebApps-Getting-Started/">article</a>).</p>

<h4 id="resizing-functions">Resizing Functions</h4>
<p>The image resizing function is simple because I used OpenCV to resize the images. The most important part of this project is to learn how to use Flask to build your Python web applications.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Resize a image using user-defined parameters</span>
<span class="k">def</span> <span class="nf">resizer_ratio</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">fx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fy</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">src</span> <span class="o">=</span> <span class="n">img</span><span class="p">,</span> <span class="n">dsize</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span> <span class="o">=</span> <span class="n">fy</span><span class="p">,</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">resizer_defined</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">src</span> <span class="o">=</span> <span class="n">img</span><span class="p">,</span> <span class="n">dsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">fx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></code></pre></figure>

<h4 id="choice-of-web-app-framework">Choice of Web App Framework</h4>

<p>I was hesitating whether I have to use Flask or Dejango. The feedback from Google and Quora is that Flask is more simple, user-friendly, and more convenient for simple applications, while Dejango, though more powerful and structured for large and complicated applications, might be hauting for new users without too much web app development experience. So my choice became Flask.</p>

<h4 id="choice-of-hosting-server">Choice of Hosting Server</h4>

<p>I have a little bit experience of using PythonAnywhere to host Python programs. It is very user-friendly. You do not even have to know how to use vim because it provides a text editor on the web control end. The more important thing is that its basic account is free. Every basic account could host one web application. So my choice is no doubt PythonAnywhere.</p>

<h4 id="web-application-organization">Web Application Organization</h4>

<p>The index() route render the Image Resizer Interface. Once the image and parameters were submitted, it directed to upload() to upload the image to the server, and cache the parameter. After successful upload, the image was resized in resize_image(). The file sizes before and after resize were calculated, and the filename of resized image was also cached.. When resizing image is finished, the user will be directed to a ‘download’ webpage, where there is a buttom for click to download. Once the buttom is clicked, the download() was activated and the resized image will be send to your computer from the server.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">'/upload'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">upload</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'resize_image'</span><span class="p">))</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">'/resize'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">resize_image</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'download.html'</span><span class="p">,</span> <span class="n">filesize_original</span> <span class="o">=</span> <span class="n">filesize_original</span><span class="p">,</span> <span class="n">filesize_resized</span> <span class="o">=</span> <span class="n">filesize_resized</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">'/download'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">download</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="n">directory</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">'DOWNLOAD_FOLDER'</span><span class="p">],</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_resized</span><span class="p">)</span></code></pre></figure>

<p>There might be some rendering issue due to browser cache for the resized image. It was resized but the browser rendered a cached image. I tried hard to solve this. Although I have no idea about the mechanism, the following code seems to help.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">'SEND_FILE_MAX_AGE_DEFAULT'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>

<span class="nd">@app.after_request</span>
<span class="k">def</span> <span class="nf">add_header</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="s">"""
    Add headers to both force latest IE rendering engine or Chrome Frame,
    and also to cache the rendered page for 10 minutes.
    """</span>
    <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">"Cache-Control"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"no-cache, no-store, must-revalidate"</span>
    <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">"Pragma"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"no-cache"</span>
    <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">"Expires"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
    <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'Cache-Control'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'public, max-age=0'</span></code></pre></figure>

<h4 id="caveats-on-pythonanywhere">Caveats on PythonAnywhere</h4>

<p>After preparing all the python application code and html files, the test of the application was successful on my local machine. However, when I tested the application on PythonAnywhere, some error poped up.</p>

<ul>
  <li>Absolute Path
PythonAnywhere does not support file operations using relative path. You will have to use absolute path instead. To do this, first find out the absolute path of current folder and concatenate the folder absolute path to your file/folder name.</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># This folder path</span>
<span class="n">THIS_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="c"># This is the path to the upload directory</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">'UPLOAD_FOLDER'</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">THIS_FOLDER</span><span class="p">,</span> <span class="s">'uploads/'</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">'DOWNLOAD_FOLDER'</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">THIS_FOLDER</span><span class="p">,</span> <span class="s">'downloads/'</span><span class="p">)</span></code></pre></figure>

<ul>
  <li>OpenCV3 Installation
There was OpenCV2 (for Python 2.7) pre-installed on the server. However, I need OpenCV3 (for Python 3.6) because I developed the application in Python 3.6 and Flask 0.12 was also for Python 3.6. Unlike usual pip install, to install new packages on PythonAnywhere server:</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Pip install package</span>
pip install <span class="nt">--user</span> package
<span class="c"># Pip install OpenCV3</span>
pip3.6 install <span class="nt">--user</span> opencv-python</code></pre></figure>

<h4 id="some-features">Some Features</h4>

<ul>
  <li>Examine the format of image for submission.</li>
  <li>Restrict the image size for submission to prevent blowing the server.</li>
  <li>Clear the images stored on the server routinely to prevent hitting the server hard disk limit.</li>
  <li>Show the size of images before and after resizing.</li>
</ul>

<h3 id="user-feedback">User Feedback</h3>

<p>Thank Guotu Li, Jianhai Zhang and Di Wang for initial testings and feedbacks.</p>

<ul>
  <li>Ugly interface</li>
</ul>

<p>The interface was written in pure html. I have no knowledge about how to make a good web UI interface.</p>

<ul>
  <li>Image sizer became larger after shrinking</li>
</ul>

<p>For some original small-sized image, after shrinking, the size became a little bit bigger. I think it due to the resize function and image-save function in OpenCV. I tested some compression parameters of OpenCV image-save functions. But they do not make too much difference. I will study OpenCV in depth in the future if I get chance.</p>

<h3 id="source-code">Source Code</h3>

<p>To view source code, please visit my <a href="https://github.com/leimao/Image_Resizer">GitHub</a>.</p>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          
	<img src="http://localhost:4000/images//author_images/VinitSmall.jpg" class="bio-photo" alt="Vinit Sheth bio photo"></a>

<h3>Vinit Sheth</h3>
<p>Data Science , Machine Learning, Artificial Intelligence.</p>



<a href="http://linkedin.com/in/vinit-sheth" class="author-social" target="_blank"><i class="fa fa-linkedin-square"></i> LinkedIn</a>


<a href="http://github.com/vinitsheth" class="author-social" target="_blank"><i class="fa fa-github-square"></i> GitHub</a>









<a href="http://facebook.com/vinitgsheth" class="author-social" target="_blank"><i class="fa fa-facebook-square"></i> Facebook</a>
<a href="mailto:vsheth2@asu.edu" class="author-social" target="_blank"><i class="fa fa-envelope-square"></i> E-Mail</a>
<a href="https://drive.google.com/open?id=1ElcWvlcYgbx_Pw4amAY230AAM5meI6zQ" class="author-social" target="_blank"><i class="fa fa-file"></i>Resume</a>
        </div>
       <!-- <p class="byline"><strong>Image Resizer Python Web App</strong> was published on <time datetime=""></time> and last modified on <time datetime="2017-08-26">August 26, 2017</time> by <a href="http://localhost:4000" title="About Vinit Sheth">Vinit Sheth</a>.</p> -->
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <footer>
    <span>&copy; 2019 Vinit Sheth. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<!-- Old
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-133931159-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
-->
<!-- New -->
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-133931159-1', 'auto');
  ga('send', 'pageview');

</script>



  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vinitsheth-github-io'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	        

</body>
</html>